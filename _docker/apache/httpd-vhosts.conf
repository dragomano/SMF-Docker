<VirtualHost *:80>
    ServerName localhost
    RewriteEngine on
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301]
</VirtualHost>

<VirtualHost *:443>
    ServerName localhost
    DocumentRoot "/app"

    ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://php-fpm:9000/app/$1

    SSLEngine on
    SSLCertificateFile "/usr/local/apache2/conf/certs/server.crt"
    SSLCertificateKeyFile "/usr/local/apache2/conf/certs/server.key"

    RequestHeader set X-Forwarded-Proto "https" early
    RequestHeader set X-Forwarded-Ssl "on"

    <Directory "/app">
        Options -Indexes +FollowSymLinks -MultiViews
        AllowOverride All
        Require all granted
        DirectoryIndex index.php
    </Directory>
</VirtualHost>